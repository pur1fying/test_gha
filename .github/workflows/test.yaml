name: test_build android lib workflow
on:
    workflow_dispatch:
      inputs:
        create_release:
          description: 'Create new release'
          required: true
          type: boolean
    push:
        branches:
        - main
    pull_request:
        branches:
        - main

jobs:
  Android-arm64-v8a-lib:
    name: â€˜Android arm64-v8a lib build and release'
    runs-on: windows-latest
    steps:
      - name: Clone Source Repo
        id: checkout_main
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          path: "baas_cpp"
      - name: display repo files
        run: dir baas_cpp
      - name: CMake Build
        id: cmake_configure
        working-directory: ./baas_cpp
        run: |
          cmake -G Ninja ^
              -B build ^
              -DCMAKE_TOOLCHAIN_FILE="%ANDROID_NDK_LATEST_HOME%\build\cmake\android.toolchain.cmake" ^
              -DANDROID_NDK_PATH="%ANDROID_NDK_LATEST_HOME%" ^
              -DANDROID_ABI=arm64-v8a ^
              -DANDROID_PLATFORM=android-26 ^
              -DBUILD_BAAS_OCR=ON ^
              -DBAAS_OCR_ANDROID_BUILD=ON ^
              -DCMAKE_BUILD_TYPE=Release
          cmake --build build --config Release --target all -- -j 4